<div class="chat-input-container">
    <textarea
        id="chat-input"
        rows="1"
        placeholder="Type a message..."
        value="@_inputText"
        @oninput="OnInput"
        @onkeydown="OnKeyDown"
        disabled="@IsDisabled">
    </textarea>
    <button class="send-btn" @onclick="SendMessage" disabled="@(string.IsNullOrWhiteSpace(_inputText) || IsDisabled)">
        â–¶
    </button>
</div>

@code {
    [Inject]
    private IJSRuntime JS { get; set; } = default!;

    [Parameter]
    public EventCallback<string> OnSend { get; set; }

    [Parameter]
    public bool IsDisabled { get; set; }

    private string _inputText = "";

    private async Task OnInput(ChangeEventArgs e)
    {
        _inputText = e.Value?.ToString() ?? "";
        await JS.InvokeVoidAsync("chatHelpers.autoExpand", "chat-input");
    }

    private async Task OnKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !e.ShiftKey)
        {
            await SendMessage();
        }
    }

    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(_inputText) || IsDisabled)
            return;

        var message = _inputText;
        _inputText = "";
        await JS.InvokeVoidAsync("chatHelpers.resetTextarea", "chat-input");
        await OnSend.InvokeAsync(message);
    }
}

