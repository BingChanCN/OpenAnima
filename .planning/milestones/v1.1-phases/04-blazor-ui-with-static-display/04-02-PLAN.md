---
phase: 04-blazor-ui-with-static-display
plan: 02
type: execute
wave: 2
depends_on:
  - "04-01"
files_modified:
  - src/OpenAnima.Core/Components/Pages/Modules.razor
  - src/OpenAnima.Core/Components/Pages/Modules.razor.css
  - src/OpenAnima.Core/Components/Pages/Heartbeat.razor
  - src/OpenAnima.Core/Components/Pages/Heartbeat.razor.css
  - src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor
  - src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor.css
autonomous: true
requirements:
  - MOD-06
  - MOD-07

must_haves:
  truths:
    - "User can view a list of all loaded modules with status indicators (green dot + Loaded)"
    - "User can click a module card to see full metadata in a modal (name, version, description, load time, file path)"
    - "Module cards are sorted by load order"
    - "Empty state shows icon + text prompt when no modules loaded"
    - "User can view heartbeat running state (Running/Stopped) with green/red visual treatment"
    - "User can view heartbeat statistics (tick count, skipped count)"
    - "Module card grid collapses to single column on narrow screens"
  artifacts:
    - path: "src/OpenAnima.Core/Components/Pages/Modules.razor"
      provides: "Module list page with card grid and modal trigger"
      contains: "ModuleService.GetAllModules"
    - path: "src/OpenAnima.Core/Components/Pages/Modules.razor.css"
      provides: "Card grid layout with responsive breakpoint"
      contains: "module-grid"
    - path: "src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor"
      provides: "Reusable modal dialog for module details"
      contains: "IsVisible"
    - path: "src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor.css"
      provides: "Modal overlay and dialog styling"
      contains: "modal-backdrop"
    - path: "src/OpenAnima.Core/Components/Pages/Heartbeat.razor"
      provides: "Heartbeat status page with running state and statistics"
      contains: "HeartbeatService.IsRunning"
    - path: "src/OpenAnima.Core/Components/Pages/Heartbeat.razor.css"
      provides: "Heartbeat page styling with status card"
      contains: "status-card-large"
  key_links:
    - from: "Modules.razor"
      to: "IModuleService"
      via: "@inject IModuleService"
      pattern: "@inject IModuleService"
    - from: "Modules.razor"
      to: "ModuleDetailModal.razor"
      via: "Component reference with IsVisible parameter"
      pattern: "ModuleDetailModal"
    - from: "Heartbeat.razor"
      to: "IHeartbeatService"
      via: "@inject IHeartbeatService"
      pattern: "@inject IHeartbeatService"
    - from: "Modules.razor"
      to: "PluginRegistryEntry data"
      via: "entry.Module.Metadata and entry.Manifest"
      pattern: "entry\\.Module\\.Metadata"
---

<objective>
Create the Modules page with card grid and detail modal, and the Heartbeat status page with prominent state display and statistics.

Purpose: Delivers the core monitoring UI — users can see all loaded modules with metadata and monitor heartbeat state. These are the primary data display pages that Phase 5 will enhance with real-time updates.

Output: Modules.razor with card grid + ModuleDetailModal, Heartbeat.razor with status card and stats, all with responsive CSS.
</objective>

<execution_context>
@/home/user/.claude/get-shit-done/workflows/execute-plan.md
@/home/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-blazor-ui-with-static-display/04-CONTEXT.md
@.planning/phases/04-blazor-ui-with-static-display/04-RESEARCH.md
@.planning/phases/04-blazor-ui-with-static-display/04-01-SUMMARY.md
@src/OpenAnima.Core/Services/IModuleService.cs
@src/OpenAnima.Core/Services/IHeartbeatService.cs
@src/OpenAnima.Core/Plugins/PluginRegistry.cs
@src/OpenAnima.Core/Plugins/PluginManifest.cs
@src/OpenAnima.Contracts/IModuleMetadata.cs
@src/OpenAnima.Core/wwwroot/css/app.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Modules page with card grid and detail modal</name>
  <files>
    src/OpenAnima.Core/Components/Pages/Modules.razor
    src/OpenAnima.Core/Components/Pages/Modules.razor.css
    src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor
    src/OpenAnima.Core/Components/Shared/ModuleDetailModal.razor.css
  </files>
  <action>
**Create ModuleDetailModal.razor** in `Components/Shared/` directory (create Shared directory if needed):

A reusable modal component with parameters:
- `[Parameter] public bool IsVisible { get; set; }` — controls show/hide
- `[Parameter] public string Title { get; set; } = ""` — modal header title
- `[Parameter] public RenderFragment? ChildContent { get; set; }` — content projection
- `[Parameter] public EventCallback OnClose { get; set; }` — close callback

Structure: When IsVisible is true, render:
- `.modal-backdrop` div with `@onclick="Close"` (click outside to close)
- `.modal-dialog` div with `@onclick:stopPropagation="true"` (prevent backdrop click from closing when clicking dialog)
  - `.modal-header` with `<h2>@Title</h2>` and close button (&#x2715; character) with `@onclick="Close"`
  - `.modal-body` with `@ChildContent`

The `Close` method: `private async Task Close() { await OnClose.InvokeAsync(); }` — MUST await to propagate state changes.

**Create ModuleDetailModal.razor.css:**
- `.modal-backdrop`: `position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 999;`
- `.modal-dialog`: `position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 1000; background: var(--surface-card); border: 1px solid var(--border-color); border-radius: 12px; max-width: 560px; width: 90%; max-height: 80vh; overflow-y: auto;`
- `.modal-header`: flex row, space-between, padding 20px, border-bottom
- `.modal-header h2`: font-size 1.1rem, font-weight 600
- Close button: no background/border, color var(--text-secondary), cursor pointer, hover color var(--text-primary)
- `.modal-body`: padding 20px

**Create Modules.razor** at `@page "/modules"`:

Inject `@inject IModuleService ModuleService` and add `@using OpenAnima.Core.Plugins` for PluginRegistryEntry type.

Page structure:
1. `<h1 class="page-title">Modules</h1>`
2. If `ModuleService.Count == 0`: render empty state div with icon (&#x25A8;) and text "No modules loaded. Place module folders in the modules directory."
3. Else: render `.module-grid` div with `@foreach` over `ModuleService.GetAllModules()` producing module cards

Each module card (`.module-card` using `.card` base class):
- Click handler: `@onclick="() => ShowDetails(entry)"`
- `.module-card-header`: flex row with module name (`entry.Module.Metadata.Name`) and status indicator
- Status indicator: `<span class="status-indicator loaded"><span class="status-dot"></span>Loaded</span>` (all modules show as Loaded per research — error tracking deferred to Phase 6)
- `.module-card-body`: version display `v{entry.Module.Metadata.Version}`

Component state:
- `private PluginRegistryEntry? selectedModule;`
- `private bool showModal;`
- `ShowDetails(entry)`: sets selectedModule = entry, showModal = true
- `CloseModal()`: sets showModal = false

Below the grid, render the ModuleDetailModal:
```razor
<ModuleDetailModal IsVisible="@showModal"
                   Title="@(selectedModule?.Module.Metadata.Name ?? "")"
                   OnClose="@CloseModal">
    @if (selectedModule != null)
    {
        <div class="detail-grid">
            <div class="detail-row">
                <span class="detail-label">Version</span>
                <span class="detail-value">@selectedModule.Module.Metadata.Version</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Description</span>
                <span class="detail-value">@(selectedModule.Module.Metadata.Description ?? "No description")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Loaded At</span>
                <span class="detail-value mono">@selectedModule.LoadedAt.ToString("yyyy-MM-dd HH:mm:ss")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Assembly</span>
                <span class="detail-value mono">@selectedModule.Manifest.EntryAssembly</span>
            </div>
        </div>
    }
</ModuleDetailModal>
```

Note: Author field is NOT in IModuleMetadata or PluginManifest — omit per research recommendation. Show assembly name as "file path" equivalent since PluginLoadContext.Name gives the load context name.

**Create Modules.razor.css:**
- `.module-grid`: `display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;`
- `.module-card`: extends `.card` visually (background, border, border-radius from app.css .card class), add `cursor: pointer; transition: border-color 0.15s ease;`
- `.module-card:hover`: `border-color: var(--accent-color);`
- `.module-card-header`: `display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;`
- `.module-card-name`: `font-weight: 600; font-size: 0.95rem;`
- `.module-card-body`: `color: var(--text-secondary); font-size: 0.85rem;`
- Status indicator styles (`.status-indicator`, `.status-dot`, `.loaded`): green dot + text as specified in CONTEXT.md
- `.empty-state`: centered, padding 60px, text-align center
- `.empty-state-icon`: font-size 2.5rem, color var(--text-muted), margin-bottom 12px
- `.empty-state-text`: color var(--text-secondary), font-size 0.9rem
- `.detail-grid`: display flex, flex-direction column, gap 16px
- `.detail-row`: display flex, flex-direction column, gap 4px
- `.detail-label`: font-size 0.75rem, text-transform uppercase, letter-spacing 0.05em, color var(--text-secondary)
- `.detail-value`: font-size 0.9rem, color var(--text-primary)
- `@media (max-width: 768px)`: `.module-grid { grid-template-columns: 1fr; }` — force single column
  </action>
  <verify>
Run `dotnet build src/OpenAnima.Core/` — must compile without errors. Verify Modules.razor has @page "/modules" directive. Verify ModuleDetailModal.razor has IsVisible, Title, ChildContent, OnClose parameters. Verify empty state is handled. Verify CSS has responsive breakpoint.
  </verify>
  <done>
Modules page renders at /modules with card grid showing all loaded modules. Each card shows name, version, and green "Loaded" status indicator. Clicking a card opens a modal with full metadata (name, version, description, load time, assembly). Empty state displays when no modules loaded. Grid collapses to single column on mobile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Heartbeat status page</name>
  <files>
    src/OpenAnima.Core/Components/Pages/Heartbeat.razor
    src/OpenAnima.Core/Components/Pages/Heartbeat.razor.css
  </files>
  <action>
**Create Heartbeat.razor** at `@page "/heartbeat"`:

Inject `@inject IHeartbeatService HeartbeatService`.

Page structure per user decision — "Prominent status card at top: large Running/Stopped with green/red visual treatment. Statistics below status card in vertical layout (top-down)."

1. `<h1 class="page-title">Heartbeat</h1>`
2. `.heartbeat-container` wrapper div
3. `.status-card-large` div (prominent status display):
   - `.status-label`: "Status" text
   - `.status-value` with conditional class: `@(HeartbeatService.IsRunning ? "running" : "stopped")`
   - Display text: `@(HeartbeatService.IsRunning ? "Running" : "Stopped")`
4. `.stats-container` div (vertical layout below status):
   - Stat card for Tick Count: label "Tick Count", value `@HeartbeatService.TickCount` with mono class
   - Stat card for Skipped Count: label "Skipped", value `@HeartbeatService.SkippedCount` with mono class

When heartbeat not started (IsRunning is false): show "Stopped" in red, stats show their current values (0 if never started). Per user decision: "When heartbeat not started: static prompt, stats show 0 or --". Use the actual values from the service (they'll be 0 if never started).

**Create Heartbeat.razor.css:**
- `.heartbeat-container`: `max-width: 600px;` (constrain width for readability)
- `.status-card-large`: Uses card base styling (background var(--surface-card), border, border-radius 8px, padding 32px), text-align center, margin-bottom 24px
- `.status-label`: font-size 0.8rem, text-transform uppercase, letter-spacing 0.08em, color var(--text-secondary), margin-bottom 8px
- `.status-value`: font-size 2rem, font-weight 700
- `.status-value.running`: color var(--success-color)
- `.status-value.stopped`: color var(--error-color)
- `.stats-container`: display flex, flex-direction column, gap 12px
- `.stat-card`: card base styling, display flex, justify-content space-between, align-items center, padding 16px 20px
- `.stat-card .stat-label`: font-size 0.9rem, color var(--text-secondary)
- `.stat-card .stat-value`: font-size 1.1rem, font-weight 600, color var(--text-primary)
- Page title uses existing `.page-title` from Dashboard.razor.css pattern (already defined in scoped CSS — redefine in this file's scoped CSS or rely on app.css if it's global). Since `.page-title` is defined in Dashboard.razor.css (scoped), redefine it here: `font-size: 1.5rem; font-weight: 600; margin-bottom: 24px; color: var(--text-primary);`
  </action>
  <verify>
Run `dotnet build src/OpenAnima.Core/` — must compile without errors. Verify Heartbeat.razor has @page "/heartbeat" directive. Verify it injects IHeartbeatService and displays IsRunning, TickCount, and SkippedCount. Verify CSS has .status-value.running and .status-value.stopped with correct colors.
  </verify>
  <done>
Heartbeat page renders at /heartbeat with prominent Running/Stopped status in green/red, and statistics (tick count, skipped count) displayed below in vertical layout. Static display only — real-time updates deferred to Phase 5.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build src/OpenAnima.Core/` compiles without errors
2. Navigate to /modules — shows module card grid (or empty state if no modules loaded)
3. Click a module card — modal opens with full metadata
4. Click backdrop or X button — modal closes
5. Navigate to /heartbeat — shows prominent status card and statistics
6. All three pages accessible via sidebar navigation (from Plan 04-01)
7. Module grid collapses to single column on narrow viewport
</verification>

<success_criteria>
- Modules page displays all loaded modules as cards with name, version, status indicator
- Module detail modal shows full metadata on card click
- Empty state renders when no modules loaded
- Heartbeat page shows Running/Stopped with green/red treatment
- Heartbeat statistics (tick count, skipped) displayed below status
- All pages responsive at 768px breakpoint
- Clean build with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-blazor-ui-with-static-display/04-02-SUMMARY.md`
</output>
