# Plan 03-01: Service Facades & Web Host

**Phase:** 3 — Service Abstraction & Hosting
**Requirements:** INFRA-01 (partial)
**Depends on:** Phase 2 complete

## Goal

Convert OpenAnima.Core from a console application to a Blazor Server web host. Create service facade interfaces that wrap existing runtime components (PluginRegistry, EventBus, HeartbeatLoop) and register them in DI. Implement an IHostedService that performs the startup sequence (module loading, EventBus injection, heartbeat start).

## Tasks

### 1. Convert project to Web SDK
- Change OpenAnima.Core.csproj SDK to `Microsoft.NET.Sdk.Web`
- Remove `OutputType` property (Web SDK defaults to Exe)
- Remove MediatR package reference (tech debt from v1.0 — unused)

### 2. Create service facade interfaces
- `Services/IModuleService.cs` — module listing, loading, unloading
- `Services/IHeartbeatService.cs` — start, stop, status, tick count
- `Services/IEventBusService.cs` — thin wrapper for future phases

### 3. Create service facade implementations
- `Services/ModuleService.cs` — wraps PluginRegistry + PluginLoader + EventBus injection
- `Services/HeartbeatService.cs` — wraps HeartbeatLoop
- `Services/EventBusService.cs` — wraps EventBus

### 4. Create OpenAnimaHostedService
- `Hosting/OpenAnimaHostedService.cs` — IHostedService
- StartAsync: scan modules, load, register, inject EventBus, start heartbeat, start watcher
- StopAsync: stop heartbeat, shutdown modules, dispose watcher

### 5. Rewrite Program.cs
- WebApplication.CreateBuilder(args)
- Register all services as singletons
- Add Blazor Server services
- Configure middleware pipeline
- app.Run()

## Files Created
- `src/OpenAnima.Core/Services/IModuleService.cs`
- `src/OpenAnima.Core/Services/IHeartbeatService.cs`
- `src/OpenAnima.Core/Services/IEventBusService.cs`
- `src/OpenAnima.Core/Services/ModuleService.cs`
- `src/OpenAnima.Core/Services/HeartbeatService.cs`
- `src/OpenAnima.Core/Services/EventBusService.cs`
- `src/OpenAnima.Core/Hosting/OpenAnimaHostedService.cs`

## Files Modified
- `src/OpenAnima.Core/OpenAnima.Core.csproj`
- `src/OpenAnima.Core/Program.cs`

## Verification
- [ ] Project builds with Web SDK
- [ ] Service interfaces define all needed operations
- [ ] Implementations correctly delegate to underlying components
- [ ] HostedService performs full startup sequence
- [ ] Program.cs configures DI and middleware correctly
