---
phase: 11-port-type-system-testing-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - "11-01"
files_modified:
  - src/OpenAnima.Contracts/Ports/PortColors.cs
  - src/OpenAnima.Core/Components/Shared/PortIndicator.razor
  - src/OpenAnima.Core/Components/Pages/Modules.razor
autonomous: true
requirements:
  - PORT-01

must_haves:
  truths:
    - "User can see colored circles next to port names on loaded module detail view"
    - "Text ports render as blue (#4A90D9) circles and Trigger ports render as orange (#E8943A) circles"
    - "Input ports are labeled with direction (In) and output ports with (Out)"
  artifacts:
    - path: "src/OpenAnima.Contracts/Ports/PortColors.cs"
      provides: "Static color mapping from PortType to hex color string"
      contains: "public static class PortColors"
    - path: "src/OpenAnima.Core/Components/Shared/PortIndicator.razor"
      provides: "Blazor component rendering a colored circle with port name and direction"
      contains: "PortIndicator"
  key_links:
    - from: "src/OpenAnima.Core/Components/Shared/PortIndicator.razor"
      to: "src/OpenAnima.Contracts/Ports/PortColors.cs"
      via: "PortColors.GetHex(PortType) for circle fill color"
      pattern: "PortColors.GetHex"
    - from: "src/OpenAnima.Core/Components/Pages/Modules.razor"
      to: "src/OpenAnima.Core/Components/Shared/PortIndicator.razor"
      via: "Renders PortIndicator for each discovered port in module detail modal"
      pattern: "<PortIndicator"
---

<objective>
Add minimal port visual rendering so users can see port type categories (Text, Trigger) with distinct colors on module interfaces. This satisfies PORT-01's success criterion without building the full drag-and-drop editor (Phase 13).

Purpose: PORT-01 requires visual color distinction for port types. The backend contracts from Plan 01 define PortType with color doc comments, but nothing renders them. This plan bridges that gap with a PortIndicator component and integrates it into the existing Modules page detail modal.

Output: PortColors utility class, PortIndicator.razor shared component, updated Modules.razor showing ports on loaded modules.
</objective>

<execution_context>
@/home/user/.claude/get-shit-done/workflows/execute-plan.md
@/home/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-port-type-system-testing-foundation/11-01-SUMMARY.md

<interfaces>
<!-- From Plan 01 outputs -->

From src/OpenAnima.Contracts/Ports/PortType.cs:
```csharp
public enum PortType { Text = 0, Trigger = 1 }
```

From src/OpenAnima.Contracts/Ports/PortDirection.cs:
```csharp
public enum PortDirection { Input = 0, Output = 1 }
```

From src/OpenAnima.Contracts/Ports/PortMetadata.cs:
```csharp
public record PortMetadata(string Name, PortType Type, PortDirection Direction, string ModuleName);
```

From src/OpenAnima.Core/Ports/PortDiscovery.cs:
```csharp
public class PortDiscovery { public List<PortMetadata> DiscoverPorts(Type moduleType); }
```

<!-- Existing UI contracts -->

From src/OpenAnima.Core/Components/Pages/Modules.razor:
- Uses `ModuleService.GetAllModules()` returning `PluginRegistryEntry` items
- Each entry has `entry.Module` (IModule) and `entry.Manifest`
- Module detail modal shows metadata when user clicks a loaded module
- `entry.Module.GetType()` gives the runtime Type for port discovery
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: PortColors utility and PortIndicator Blazor component</name>
  <files>
    src/OpenAnima.Contracts/Ports/PortColors.cs
    src/OpenAnima.Core/Components/Shared/PortIndicator.razor
  </files>
  <action>
    1. **PortColors.cs** — Static utility in `OpenAnima.Contracts.Ports` namespace:
       - `public static string GetHex(PortType type)` returning:
         - `PortType.Text` → `"#4A90D9"` (blue, per user decision)
         - `PortType.Trigger` → `"#E8943A"` (orange, per user decision)
         - Default/unknown → `"#888888"` (gray fallback)
       - `public static string GetLabel(PortType type)` returning the enum name as string

    2. **PortIndicator.razor** — Shared Blazor component in `src/OpenAnima.Core/Components/Shared/`:
       - Parameters: `[Parameter] public PortMetadata Port { get; set; }`
       - Renders an inline SVG circle (12px diameter) filled with `PortColors.GetHex(Port.Type)`
       - Next to the circle: port name text and direction label "(In)" or "(Out)"
       - Input ports show a left-arrow indicator, output ports show right-arrow
       - CSS: inline-flex layout, 4px gap between circle and text, font-size 0.85rem
       - Use `@using OpenAnima.Contracts.Ports` for type access

    Per user decision: all ports are uniform circles, only color distinguishes type. Text=blue #4A90D9, Trigger=orange #E8943A. Name labels always visible.
  </action>
  <verify>
    <automated>dotnet build src/OpenAnima.Core/OpenAnima.Core.csproj</automated>
  </verify>
  <done>PortColors returns correct hex for Text (#4A90D9) and Trigger (#E8943A). PortIndicator.razor compiles and renders a colored circle with port name and direction.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate port display into Modules page detail modal</name>
  <files>
    src/OpenAnima.Core/Components/Pages/Modules.razor
  </files>
  <action>
    Update the ModuleDetailModal content section in Modules.razor to show discovered ports for the selected module.

    1. Add `@using OpenAnima.Contracts.Ports` and `@using OpenAnima.Core.Ports` at the top
    2. Inject or instantiate `PortDiscovery` — since it's a simple stateless class with no dependencies, create `new PortDiscovery()` inline (no DI needed)
    3. In the `@if (selectedModule != null)` block, after the existing detail-grid div, add a "Ports" section:
       - Call `new PortDiscovery().DiscoverPorts(selectedModule.Module.GetType())` to get ports
       - If ports list is non-empty, render a "Ports" heading
       - Split ports into two groups: inputs (Direction == Input) and outputs (Direction == Output)
       - Render inputs on the left column with header "Inputs", outputs on the right column with header "Outputs"
       - Each port rendered via `<PortIndicator Port="@port" />`
       - If no ports found, show "No ports declared" in muted text
    4. Add minimal CSS in a `<style>` block or inline styles:
       - `.port-section` — margin-top: 1rem, two-column grid (inputs | outputs)
       - `.port-column` — flex column with 0.5rem gap
       - `.port-column-header` — small caps, muted color, font-size 0.75rem

    This gives users immediate visual feedback: when they click a loaded module, they see its declared ports with color-coded type indicators. Modules without port attributes show "No ports declared" — this is expected until Phase 14 refactors existing modules.
  </action>
  <verify>
    <automated>dotnet build src/OpenAnima.Core/OpenAnima.Core.csproj</automated>
  </verify>
  <done>Modules page detail modal shows port section with color-coded PortIndicator components for each discovered port. Text ports appear blue, Trigger ports appear orange. Modules without port attributes show "No ports declared".</done>
</task>

</tasks>

<verification>
1. `dotnet build` — entire solution compiles with no errors
2. PortColors.GetHex(PortType.Text) returns "#4A90D9" and PortColors.GetHex(PortType.Trigger) returns "#E8943A"
3. PortIndicator.razor renders colored SVG circle with port name and direction label
4. Modules page detail modal shows "Ports" section with input/output columns
5. Modules without port attributes show "No ports declared" gracefully
</verification>

<success_criteria>
- User can see port type categories displayed with distinct visual colors on module interfaces (PORT-01)
- Text ports render as blue (#4A90D9) circles, Trigger ports as orange (#E8943A) circles
- Port names and directions are visible next to each colored indicator
- Existing Modules page functionality unchanged (load/unload still works)
</success_criteria>

<output>
After completion, create `.planning/phases/11-port-type-system-testing-foundation/11-03-SUMMARY.md`
</output>
