---
phase: 20-cli-foundation-templates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/OpenAnima.Cli/OpenAnima.Cli.csproj
  - src/OpenAnima.Cli/Program.cs
  - src/OpenAnima.Cli/ExitCodes.cs
autonomous: true
requirements:
  - CLI-01
  - CLI-02
  - CLI-03
  - CLI-04
  - CLI-05

must_haves:
  truths:
    - "Developer can install oani CLI as .NET global tool"
    - "Developer can run `oani --help` to see available commands"
    - "CLI returns exit code 0 on success, non-zero on failure"
    - "CLI outputs errors to stderr, normal output to stdout"
    - "Developer can set verbosity level with `-v` or `--verbosity` option"
  artifacts:
    - path: "src/OpenAnima.Cli/OpenAnima.Cli.csproj"
      provides: ".NET global tool project configuration"
      contains: "PackAsTool"
    - path: "src/OpenAnima.Cli/Program.cs"
      provides: "CLI entry point with System.CommandLine"
      min_lines: 50
    - path: "src/OpenAnima.Cli/ExitCodes.cs"
      provides: "Exit code constants"
  key_links:
    - from: "Program.cs"
      to: "System.CommandLine"
      via: "RootCommand setup"
      pattern: "RootCommand|Subcommands|Invoke"
---

<objective>
Create the OpenAnima.Cli project as an installable .NET global tool with System.CommandLine for CLI parsing.

Purpose: Establish the foundation for the `oani` CLI tool that developers can install globally.
Output: A working CLI tool that responds to `--help`, handles exit codes, and separates stdout/stderr.
</objective>

<execution_context>
@/home/user/.claude/get-shit-done/workflows/execute-plan.md
@/home/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-cli-foundation-templates/20-CONTEXT.md
@.planning/phases/20-cli-foundation-templates/20-RESEARCH.md

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From RESEARCH.md - System.CommandLine pattern:
```csharp
// CLI entry point pattern
RootCommand rootCommand = new("OpenAnima module development CLI");
return rootCommand.Parse(args).Invoke();
```

From CONTEXT.md - Locked decisions:
- Silent-first output: Default quiet, `--verbose` for details
- Exit codes: 0 = success, non-0 = failure
- Error stream: stderr for errors, stdout for normal output
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OpenAnima.Cli project with System.CommandLine</name>
  <files>src/OpenAnima.Cli/OpenAnima.Cli.csproj, src/OpenAnima.Cli/ExitCodes.cs</files>
  <action>
Create a new .NET 8 console application project at `src/OpenAnima.Cli/`:

1. Create `OpenAnima.Cli.csproj` with:
   - TargetFramework: net8.0
   - PackAsTool: true (enables `dotnet tool install`)
   - ToolCommandName: oani (sets the command name)
   - PackageId: OpenAnima.Cli
   - Version: 1.0.0
   - PackageOutputPath: ./nupkg

2. Add System.CommandLine package reference (version 2.0.0-beta4.22272.1):
   ```xml
   <PackageReference Include="System.CommandLine" Version="2.0.0-beta4.22272.1" />
   ```

3. Create `ExitCodes.cs` with constants:
   - Success = 0
   - GeneralError = 1
   - ValidationError = 2

Do NOT create Program.cs yet (Task 2 handles that).
  </action>
  <verify>
    <automated>dotnet build src/OpenAnima.Cli/OpenAnima.Cli.csproj</automated>
  </verify>
  <done>
    - Project compiles successfully
    - PackAsTool=true in .csproj
    - ToolCommandName=oani in .csproj
    - System.CommandLine package referenced
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement CLI entry point with System.CommandLine</name>
  <files>src/OpenAnima.Cli/Program.cs</files>
  <action>
Create `Program.cs` with System.CommandLine RootCommand setup:

1. Create a RootCommand with description "OpenAnima module development CLI"

2. Add a global --verbosity/-v option:
   - Type: string (values: "quiet", "normal", "detailed")
   - Default: "quiet" (silent-first per user decision)
   - Description: "Set the verbosity level"

3. Add a global --version option (System.CommandLine handles this automatically when Version is set in .csproj)

4. Set up proper exit code handling:
   - Return 0 on success
   - Return non-zero on parse errors
   - Use Console.Error.WriteLine for errors (stderr)
   - Use Console.WriteLine for normal output (stdout)

5. Register a placeholder "new" subcommand (just description, no action yet - Plan 03 implements it):
   ```csharp
   Command newCommand = new("new", "Create a new module project");
   rootCommand.Subcommands.Add(newCommand);
   ```

6. Follow silent-first output: No output on successful --help or --version unless verbosity is set.

The pattern should follow System.CommandLine's idiomatic usage (see RESEARCH.md Pattern 1).
  </action>
  <verify>
    <automated>dotnet run --project src/OpenAnima.Cli/OpenAnima.Cli.csproj -- --help</automated>
  </verify>
  <done>
    - `oani --help` shows root command help with 'new' subcommand listed
    - `oani --version` shows version 1.0.0
    - `oani --verbosity detailed` accepts the option
    - Exit code is 0 for successful commands
    - Errors go to stderr (test with invalid option)
  </done>
</task>

</tasks>

<verification>
1. Build the CLI project: `dotnet build src/OpenAnima.Cli`
2. Run help: `dotnet run --project src/OpenAnima.Cli -- --help` - should show "new" command
3. Run version: `dotnet run --project src/OpenAnima.Cli -- --version` - should show 1.0.0
4. Test exit codes: Valid command returns 0, invalid option returns non-zero
5. Test verbosity: `--verbosity detailed` accepted without error
</verification>

<success_criteria>
- [ ] OpenAnima.Cli.csproj exists with PackAsTool=true and ToolCommandName=oani
- [ ] System.CommandLine package referenced with correct version
- [ ] Program.cs implements RootCommand with "new" subcommand placeholder
- [ ] --help shows available commands
- [ ] --version displays version
- [ ] Exit codes work correctly (0 success, non-0 failure)
- [ ] Verbosity option accepts quiet/normal/detailed values
</success_criteria>

<output>
After completion, create `.planning/phases/20-cli-foundation-templates/20-01-SUMMARY.md`
</output>